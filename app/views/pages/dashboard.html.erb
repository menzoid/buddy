<div class="container">

  <div class="dash-head mt-4 mb-3 d-flex justify-content-between align-items-center">
    <h3 class= "m-0">DASHBOARD</h3>
    <div class="dropleft">
      <%= cl_image_tag @user.profile.photo.key, class: "avatar-big dropdown-toggle", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
      <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
        <%= link_to "Account", edit_user_registration_path, class: "dropdown-item" %>
        <%= link_to "Profile", edit_profile_path(@user), class: "dropdown-item" %>
        <%= link_to "Log Out", destroy_user_session_path, method: :delete, class: "dropdown-item" %>
      </div>
    </div>
  </div>

</div>

<%# ----- these create the tabs (adapt for mobile)  ------- %>

  <ul class="nav nav-tabs list-inline tabs-underlined mb-2" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <a class="nav-link active tab-underlined" id="myevents-tab" data-toggle="tab" href="#myevents" role="tab" aria-controls="myevents" aria-selected="true">My Events</a>
    </li>
    <li class="nav-item" role="presentation">
      <a class="nav-link tab-underlined" id="nudgesin-tab" data-toggle="tab" href="#nudgesin" role="tab" aria-controls="nudgesin" aria-selected="false">Notifications</a>
    </li>
    <li class="nav-item" role="presentation">
      <a class="nav-link tab-underlined" id="nudgespending-tab" data-toggle="tab" href="#nudgespending" role="tab" aria-controls="nudgespending" aria-selected="false">Pending</a>
    </li>
  </ul>

  <%#---     this is the tabbed content  -----%>

  <div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="myevents" role="tabpanel" aria-labelledby="myevents-tab">

              <%# upcoming section %>

      <div class="app scroll-section-top">
        <h5>Upcoming Events</h5>
        <ul class="hs full no-scrollbar">
          <% @events.each do |event| %>
            <%= link_to event_path(event) do %>
              <li class="event-card">
                <div class="event-card-photo">
                  <%= cl_image_tag event.photo.key %>
                </div>
                <div class="event-card-info p-2">
                  <div class="date-guests d-flex justify-content-between">
                    <div class="date-time"><%= event.date.strftime("%d/%m/%Y") %> | <%= event.time.strftime("%k:%M")%></div>
                    <div class="guestcount"><i class="fas fa-users"></i> <%= event.bookings.count %></div>
                  </div>
                  <p><%= event.name %></p>
                  <div class="event-location text-right">
                    <p><i class="fas fa-map-marker-alt"></i> <%= event.address %></p>
                  </div>
                </div>
              </li>
            <% end %>
          <% end %>
        </ul>
      </div>

                        <%# Categories tabs %>
      <div>
        <ul class="nav nav-tabs list-inline list-inline-scroll mb-3" id="catTab" role="tablist">
            <li class="nav-item" role="presentation">
              <a class="nav-link" id='<%=@categories.first.name%>-tab' data-toggle="tab" href="#<%=@categories.first.name%>" role="tab" aria-controls="<%=@categories.first.name%>" aria-selected="false"><%=@categories.first.name%></a>
            </li>
          <% @categories.each do |category| %>
            <li class="nav-item" role="presentation">
              <a class="nav-link" id='<%=category.name%>-tab' data-toggle="tab" href="#<%=category.name%>" role="tab" aria-controls="<%category.name%>" aria-selected="false"><%=category.name%></a>
            </li>
          <% end %>
        </ul>

                <%# Events by category %>

        <div class="tab-content" id="catTabContent">
          <div class="tab-pane fade show active" id="<%=@categories.first.name%>" role="tabpanel" aria-labelledby="<%=@categories.first.name%>-tab">
            <div class="app scroll-section">
              <h5><%=@categories.first.name%></h5>
              <ul class="hs full no-scrollbar">
                <% @categories.first.events.each do |event| %>
                  <%= link_to event_path(event) do %>
                    <li class="event-card">
                      <div class="event-card-photo">
                        <%= cl_image_tag event.photo.key %>
                      </div>
                      <div class="event-card-info p-2">
                        <div class="date-guests d-flex justify-content-between">
                          <div class="date-time"><%= event.date.strftime("%d/%m/%Y") %> | <%= event.time.strftime("%k:%M")%></div>
                          <div class="guestcount"><i class="fas fa-users"></i> <%= event.bookings.count %></div>
                        </div>
                        <p><%= event.name %></p>
                        <div class="event-location text-right">
                          <p><i class="fas fa-map-marker-alt"></i> <%= event.address %></p>
                        </div>
                      </div>
                    </li>
                  <% end %>
                <% end %>
              </ul>
            </div>
          </div>
        <% @categories.each do |category| %>
          <div class="tab-pane fade show" id="<%=category.name%>" role="tabpanel" aria-labelledby="<%=category.name%>-tab">
            <div class="app scroll-section">
                <h5><%= category.name %></h5>
                <ul class="hs full no-scrollbar">
                  <% category.events.each do |event| %>
                    <%= link_to event_path(event) do %>
                      <li class="event-card">
                        <div class="event-card-photo">
                          <%= cl_image_tag event.photo.key %>
                        </div>
                        <div class="event-card-info p-2">
                          <div class="date-guests d-flex justify-content-between">
                            <div class="date-time"><%= event.date.strftime("%d/%m/%Y") %> | <%= event.time.strftime("%k:%M")%></div>
                            <div class="guestcount"><i class="fas fa-users"></i> <%= event.bookings.count %></div>
                          </div>
                          <p><%= event.name %></p>
                          <div class="event-location text-right">
                            <p><i class="fas fa-map-marker-alt"></i> <%= event.address %></p>
                          </div>
                        </div>
                      </li>
                    <% end %>
                  <% end %>
                </ul>
            </div>
          </div>
        <% end %>
        </div>
      </div>
        <%# ----- Calendar  ------- %>

      <div class="calendar-container">
        <%= month_calendar(events: @events_month) do |date, events| %>
          <%= date %>
          <% events.each do |event| %>
            <div class="events_month">
              <p><%= link_to event.name[0..6], event_path(event) %></p>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>

                        <%# Notifcations %>

    <div class="tab-pane fade" id="nudgesin" role="tabpanel" aria-labelledby="nudgesin-tab">
      <div class="mb-2 mt-4 info-section">
        <div>
         <% @notifications.each do |notification|  %>
          <div class="notification mb-2">
            <%= cl_image_tag notification.requester.user.profile.photo.key, class: 'avatar-big' %>
            <div class="notification-content">
              <h6><small>from</small> <%= notification.requester.user.profile.username %> <small>for</small>  <%= notification.created_at.strftime("%d %m") %></h6>
              <p class= "reason-comment mt-3">"<%= notification.reason %>"</p>
              <h6 class="notification-event mt-3"><small>for: </small><%= notification.requester.event.name[0..23] %>...</h6>
            </div>

            <div class="notification-actions mr-4">
              <%= link_to accept_request_url(notification), method: :patch do %>
                <i class="fas fa-check-circle text-success"></i>
              <% end %>
              <%= link_to reject_request_path(notification), method: :patch do %>
                <i class="fas fa-times-circle text-danger"></i>
              <% end %>
            </div>
          </div>
         <% end  %>
        </div>
      </div>
    </div>

                              <%# Requests %>

    <div class="tab-pane fade" id="nudgespending" role="tabpanel" aria-labelledby="nudgespending-tab">
      <div class="mb-2 info-section">
        <div>
         <% @requests.each do |request|  %>
          <div class="request mb-1">
            <%= cl_image_tag request.requestee.user.profile.photo.key, class: 'avatar-big' %>
            <div class="request-content">
              <h6><small>sent to:</small> <%= request.requestee.user.profile.username %> <small>on</small> <%= request.created_at.strftime("%d %m") %></h6>
              <p class= "reason-comment mt-3">"<%= request.reason %>"</p>
              <h6 class="request-event mt-3"><small>for: </small><%= request.requestee.event.name[0..23] %>...</h6>
            </div>
          </div>
         <% end  %>
        </div>
      </div>
    </div>
  </div>
